{% extends 'base.html.twig' %}

{% block title %}New Souscripteur{% endblock %}

{% block body %}
<script>
//Ajout d'un enfant
function addEnfants(collectionHolder)
{
//let block_colis = $("#block_colis");
    let prototype = collectionHolder.attr("data-prototype");
    let index = collectionHolder.data("index");

    let newForm = prototype.replace(/__name__/g, index+1);
    /*let newColisElt = colisFormElt.replace(/__nb__/g, index+1);
    newColisElt = newColisElt.replace(/__formContent__/g, newForm);*/
    collectionHolder.append(newForm);
    //collectionHolder.find(".onlyNumbers").onlyNumbers();
    /*collectionHolder.find(".onlyNumbers").numeric({
        allowMinus   : false,
    });
    collectionHolder.find(".btn_colis_remove").off("click");
    collectionHolder.find(".btn_colis_remove").on("click", function(){
        removeColisForm($(this));
    });
    collectionHolder.data("index", index+1);
    formTabIndexInit();*/
}


function removeEnfant(elt){
    //$("#main-content #bt_calculer_montant").click();
    let formParent = $(elt).closest("form");
    let collectionHolder = formParent.find("#block_enfants");
    let index = collectionHolder.data("index");
    collectionHolder.data("index", index-1);
    $(elt).closest("tr").remove();
    //expeditionIntexCalculerMontant(formParent, formParent.attr("type-client"));
}

// Ajout du conjoint
function addConjoint(collectionHolder)
{
//let block_colis = $("#block_colis");
    let prototype = collectionHolder.attr("data-prototype");
    let index = collectionHolder.data("index");

    let newForm = prototype.replace(/__name__/g, index+1);

    collectionHolder.append(newForm);
}

      function removeConjoint(elt){
    //$("#main-content #bt_calculer_montant").click();
    let formParent = $(elt).closest("form");
    let collectionHolder = formParent.find("#block_conjoint");
    let index = collectionHolder.data("index");
    collectionHolder.data("index", index-1);
    $(elt).closest("tr").remove();
    //expeditionIntexCalculerMontant(formParent, formParent.attr("type-client"));
}

      $(document).ready(function(){
           // alert("test");
            /*$(document).on("change", "#souscripteur_nombre_enfants", function(){
                  alert("nombre enfants = "+$(this).val());
            });*/
             $("#souscripteur_nombre_enfants").on("change", function(){
                  //alert("nombre enfants = "+$(this).val());
                  let nombre_enfants = $(this).val();
                  let collectionHolder = $("#block_enfants");

                  //Suppression des anciens enfants
                  collectionHolder.empty();
                  collectionHolder.data("index", 0);

                  //Ajout des nouveaux enfants
                  for(i=0;i<nombre_enfants;i++){
                        addEnfants(collectionHolder);
                  }
            });

            $("#souscripteur_situation_familiale").on("change", function(){

                  let conjoint = $(this).val();
                  console.log(conjoint);
                  let collectionHolder = $("#block_conjoint");

                  //Suppression des ancienne situation
                  collectionHolder.empty();
                  collectionHolder.data("index", 0);

                  //Ajout de conjoint ou pas 
                  //if(conjoint=="Marié(e)" || conjoint =="Pacsé(e)" || conjoint =="Concubin(e)" ){
                  if(conjoint=="marie" || conjoint =="pasce" || conjoint =="concubin" ){
                        addConjoint(collectionHolder);
                  }
                  else
                        console.log("Pas de conjoint");
            });
      });


//  Debut de form by step

// Fin de form by step

</script>

<script>
// Wait for the DOM to be ready
$(function() {
  // Initialize form validation on the registration form.
  // It has the name attribute "registration"
  $("form[id='regForm']").validate({
    // Specify validation rules
    rules: {
      // The key name on the left side is the name attribute
      // of an input field. Validation rules are defined
      // on the right side
      nom: "required",
      prenom: "required",
   
    },
    // Specify validation error messages
    messages: {
      nom: "Please enter your firstname",
      prenom: "Please enter your lastname",
    },
    // Make sure the form is submitted to the destination defined
    // in the "action" attribute of the form when valid
    submitHandler: function(form) {
      form.submit();
    }
  });
});
</script>

{% import "souscripteur/modele_enfant.html.twig" as formModelEnfant %}
{% import "souscripteur/modele_conjoint.html.twig" as formModelConjoint %}



<div class="section-form">
   <div class="container">
	<div class="columns is-vbottom">
          <div class="column is-three-fifths is-offset-one-fifth column-form">
              <div class="form_body">
			



{{ form_start(form, {'id':'regForm'}) }}
<h1 style="font-size:29px;color:#5271ff;font-weight: 700;line-height:1em; margin-bottom: 20px;">
                        Souscrire à l'assurance
</h1>


<link rel="stylesheet" href="{{ asset('https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css') }}" />
<link rel="stylesheet" href="{{ asset('https://cdn.jsdelivr.net/npm/bulma-steps@2.2.1/dist/css/bulma-steps.min.css') }}">

<div class="steps" id="stepsDemo">
  <div class="step-item is-active is-success">
    <div class="step-marker">1</div>
    <div class="step-details">
      <p class="step-title">Informations personnelles</p>
    </div>
  </div>
  <div class="step-item">
    <div class="step-marker">2</div>
    <div class="step-details">
      <p class="step-title">Vos enfants</p>
    </div>
  </div>
  <div class="step-item">
    <div class="step-marker">3</div>
    <div class="step-details">
      <p class="step-title">Situation familiale</p>
    </div>
  </div>
  <div class="step-item">
    <div class="step-marker">4</div>
    <div class="step-details">
      <p class="step-title">Pièces justificatives</p>
    </div>
  </div>
  <div class="step-item">
    <div class="step-marker">5</div>
    <div class="step-details">
      <p class="step-title">Récapitulatif</p>
    </div>
  </div>
  <div class="steps-content">
    <div class="step-content has-text-centered is-active">
      <div class="field is-horizontal">
        <div class="field-label is-normal">
          <label class="label">{{ form_label(form.civilite) }}</label>
        </div>
        <div class="field-body">
          <div class="field">
            <div class="control">
              {{ form_widget(form.civilite, {
           'attr': {
           'class':  
            'input', 
             }
          }) 
            }}
            </div>
            <small>{{ form_help(form.civilite) }}</small>
          <div class="form-error">
            {{ form_errors(form.civilite) }}
          </div>
          </div>
        </div>
      </div>

       <div class="field is-horizontal">
        <div class="field-label is-normal">
          <label class="label">{{ form_label(form.nom) }}</label>
        </div>
        <div class="field-body">
          <div class="field">
            <div class="control">
              {{ form_widget(form.nom, {'attr': {'autofocus':'autofocus', 'data-validate':'require'}}) 
            }}
            </div>
            <small>{{ form_help(form.nom) }}</small>
          <div class="form-error">
            {{ form_errors(form.nom) }}
          </div>
          </div>
        </div>
      </div>

       <div class="field is-horizontal">
        <div class="field-label is-normal">
          <label class="label">{{ form_label(form.prenom) }}</label>
        </div>
        <div class="field-body">
          <div class="field">
            <div class="control">
              {{ form_widget(form.prenom, {'attr': {'autofocus':'autofocus', 'data-validate':'require'}}) 
            }}
            </div>
            <small>{{ form_help(form.prenom) }}</small>
          <div class="form-error">
            {{ form_errors(form.prenom) }}
          </div>
          </div>
        </div>
      </div>

      <div class="field is-horizontal">
        <div class="field-label is-normal">
          <label class="label">{{ form_label(form.nom_jeune_fille) }}</label>
        </div>
        <div class="field-body">
          <div class="field">
            <div class="control">
              {{ form_widget(form.nom_jeune_fille) 
            }}
            </div>
            <small>{{ form_help(form.nom_jeune_fille) }}</small>
          <div class="form-error">
            {{ form_errors(form.nom_jeune_fille) }}
          </div>
          </div>
        </div>
      </div>

      <div class="field is-horizontal">
        <div class="field-label is-normal">
          <label class="label">{{ form_label(form.date_naissance) }}</label>
        </div>
        <div class="field-body">
          <div class="field">
            <div class="control">
              {{ form_widget(form.date_naissance, {
           'attr': {
           'class':  
            'input', 
             }
          }) 
            }}
            </div>
            <small>{{ form_help(form.date_naissance) }}</small>
          <div class="form-error">
            {{ form_errors(form.date_naissance) }}
          </div>
          </div>
        </div>
      </div>

      <div class="field is-horizontal">
        <div class="field-label is-normal">
          <label class="label">{{ form_label(form.pays_naissance) }}</label>
        </div>
        <div class="field-body">
          <div class="field">
            <div class="control">
              {{ form_widget(form.pays_naissance) 
            }}
            </div>
            <small>{{ form_help(form.pays_naissance) }}</small>
          <div class="form-error">
            {{ form_errors(form.pays_naissance) }}
          </div>
          </div>
        </div>
      </div>

      <div class="field is-horizontal">
        <div class="field-label is-normal">
          <label class="label">{{ form_label(form.ville_naissance) }}</label>
        </div>
        <div class="field-body">
          <div class="field">
            <div class="control">
              {{ form_widget(form.ville_naissance) 
            }}
            </div>
            <small>{{ form_help(form.ville_naissance) }}</small>
          <div class="form-error">
            {{ form_errors(form.ville_naissance) }}
          </div>
          </div>
        </div>
      </div>

      <div class="field is-horizontal">
        <div class="field-label is-normal">
          <label class="label">{{ form_label(form.pays_residence) }}</label>
        </div>
        <div class="field-body">
          <div class="field">
            <div class="control">
              {{ form_widget(form.pays_residence) 
            }}
            </div>
            <small>{{ form_help(form.pays_residence) }}</small>
          <div class="form-error">
            {{ form_errors(form.pays_residence) }}
          </div>
          </div>
        </div>
      </div>

      <div class="field is-horizontal">
        <div class="field-label is-normal">
          <label class="label">{{ form_label(form.ville_residence) }}</label>
        </div>
        <div class="field-body">
          <div class="field">
            <div class="control">
              {{ form_widget(form.ville_residence) 
            }}
            </div>
            <small>{{ form_help(form.ville_residence) }}</small>
          <div class="form-error">
            {{ form_errors(form.ville_residence) }}
          </div>
          </div>
        </div>
      </div>

      <div class="field is-horizontal">
        <div class="field-label is-normal">
          <label class="label">{{ form_label(form.profession) }}</label>
        </div>
        <div class="field-body">
          <div class="field">
            <div class="control">
              {{ form_widget(form.profession) 
            }}
            </div>
            <small>{{ form_help(form.profession) }}</small>
          <div class="form-error">
            {{ form_errors(form.profession) }}
          </div>
          </div>
        </div>
      </div>

      <div class="field is-horizontal">
        <div class="field-label is-normal">
          <label class="label">{{ form_label(form.adresse) }}</label>
        </div>
        <div class="field-body">
          <div class="field">
            <div class="control">
              {{ form_widget(form.adresse) 
            }}
            </div>
            <small>{{ form_help(form.adresse) }}</small>
          <div class="form-error">
            {{ form_errors(form.adresse) }}
          </div>
          </div>
        </div>
      </div>

      <div class="field is-horizontal">
        <div class="field-label is-normal">
          <label class="label">{{ form_label(form.code_postal) }}</label>
        </div>
        <div class="field-body">
          <div class="field">
            <div class="control">
              {{ form_widget(form.code_postal) 
            }}
            </div>
            <small>{{ form_help(form.code_postal) }}</small>
          <div class="form-error">
            {{ form_errors(form.code_postal) }}
          </div>
          </div>
        </div>
      </div>

      <div class="field is-horizontal">
        <div class="field-label is-normal">
          <label class="label">{{ form_label(form.ville) }}</label>
        </div>
        <div class="field-body">
          <div class="field">
            <div class="control">
              {{ form_widget(form.ville) 
            }}
            </div>
            <small>{{ form_help(form.ville) }}</small>
          <div class="form-error">
            {{ form_errors(form.ville) }}
          </div>
          </div>
        </div>
      </div>

      <div class="field is-horizontal">
        <div class="field-label is-normal">
          <label class="label">{{ form_label(form.telephone) }}</label>
        </div>
        <div class="field-body">
          <div class="field">
            <div class="control">
              {{ form_widget(form.telephone) 
            }}
            </div>
            <small>{{ form_help(form.telephone) }}</small>
          <div class="form-error">
            {{ form_errors(form.telephone) }}
          </div>
          </div>
        </div>
      </div>

      <div class="field is-horizontal">
        <div class="field-label is-normal">
          <label class="label">{{ form_label(form.tel_domicile) }}</label>
        </div>
        <div class="field-body">
          <div class="field">
            <div class="control">
              {{ form_widget(form.tel_domicile) 
            }}
            </div>
            <small>{{ form_help(form.tel_domicile) }}</small>
          <div class="form-error">
            {{ form_errors(form.tel_domicile) }}
          </div>
          </div>
        </div>
      </div>
    </div>

    <div class="step-content has-text-centered">

      <div class="field is-horizontal">
        <div class="field-label is-normal">
          <label class="label">{{ form_label(form.nombre_enfants) }}</label>
        </div>
        <div class="field-body">
          <div class="field">
            <div class="control">
              {{ form_widget(form.nombre_enfants, {'attr': {'class':'input', 'autofocus':'autofocus', 'data-validate':'require'}}) 
            }}
            </div>
            <div id="block_enfants" data-prototype="{{ formModelEnfant.enfantCollectionElt(form.enfants.vars.prototype)|e }}"></div>
                {% do form.enfants.setRendered %}
            </div>

            <small>{{ form_help(form.nombre_enfants) }}</small>
          <div class="form-error">
            {{ form_errors(form.nombre_enfants) }}
          </div>
          </div>
        </div>
      </div>

      <div class="step-content has-text-centered">
      <div class="field is-horizontal">
        <div class="field-label is-normal">
          <label class="label">{{ form_label(form.situation_familiale) }}</label>
        </div>
        <div class="field-body">
          <div class="field">
            <div class="control">
              {{ form_widget(form.situation_familiale, {'attr': {'class':'input'} }) 
            }}
            </div>
            <div id="block_conjoint" data-prototype="{{ formModelConjoint.conjointCollectionElt(form.conjoint.vars.prototype)|e }}"></div>
            {% do form.conjoint.setRendered %}
            </div>

            <small>{{ form_help(form.situation_familiale) }}</small>
          <div class="form-error">
            {{ form_errors(form.situation_familiale) }}
          </div>
          </div>
        </div>
      </div>   

    <div class="step-content has-text-centered">
    <div class="columns">
      <div class="column">
      <p>Votre pièce d'identité(recto) *</p>
      <div class="field is-horizontal">
        <div class="field-body">
          <div class="field">
            <div class="control">
            <div class="file is-large">  
            <label class="file-label">
                {{ form_widget(form.cartRecto1, {
           'attr': {
           'class':  
            'file-input', 
             }
          }) 
            }}
                <span class="file-cta">
              <span class="file-icon">
               <i class="fas fa-upload"></i>
              </span>
           <span class="file-label">
        Choisissez le fichier…
      </span>
    </span>
  </label>
  </div>
            </div>
            <small>{{ form_help(form.cartRecto1) }}</small>
          <div class="form-error">
            {{ form_errors(form.cartRecto1) }}
          </div>
          </div>
        </div>
      </div>
      </div> {# div de la column #}

      <div class="column">
      <p>Votre pièce d'identité(verso) *</p>
      <div class="field is-horizontal">
        <div class="field-body">
          <div class="field">
            <div class="control">
            <div class="file is-large">  
            <label class="file-label">
                {{ form_widget(form.cartVerso1, {
           'attr': {
           'class':  
            'file-input', 
             }
          }) 
            }}
                <span class="file-cta">
              <span class="file-icon">
               <i class="fas fa-upload"></i>
              </span>
           <span class="file-label">
        Choisissez le fichier…
      </span>
    </span>
  </label>
  </div>
            </div>
            <small>{{ form_help(form.cartVerso1) }}</small>
          <div class="form-error">
            {{ form_errors(form.cartVerso1) }}
          </div>
          </div>
        </div>
      </div>
      </div> {# div de la column #}

           </div> {# div de la columns #}

      <div class="columns">
      <div class="column">
      <p>Pièce d'identité(verso) de votre conjoint(e)</p>
      <div class="field is-horizontal">
        <div class="field-body">
          <div class="field">
            <div class="control">
            <div class="file is-large">  
            <label class="file-label">
                {{ form_widget(form.cartRecto2, {
           'attr': {
           'class':  
            'file-input', 
             }
          }) 
            }}
                <span class="file-cta">
              <span class="file-icon">
               <i class="fas fa-upload"></i>
              </span>
           <span class="file-label">
        Choisissez le fichier…
      </span>
    </span>
  </label>
  </div>
            </div>
            <small>{{ form_help(form.cartRecto2) }}</small>
          <div class="form-error">
            {{ form_errors(form.cartRecto2) }}
          </div>
          </div>
        </div>
      </div>
      </div> {# div de la column #}
      
      <div class="column">
      <p>Pièce d'identité(verso) de votre conjoint(e)</p>
      <div class="field is-horizontal">
        <div class="field-body">
          <div class="field">
            <div class="control">
            <div class="file is-large">  
            <label class="file-label">
                {{ form_widget(form.cartVerso2, {
           'attr': {
           'class':  
            'file-input', 
             }
          }) 
            }}
                <span class="file-cta">
              <span class="file-icon">
               <i class="fas fa-upload"></i>
              </span>
           <span class="file-label">
        Choisissez le fichier…
      </span>
    </span>
  </label>
  </div>
            </div>
            <small>{{ form_help(form.cartVerso2) }}</small>
          <div class="form-error">
            {{ form_errors(form.cartVerso2) }}
          </div>
          </div>
        </div>
      </div>
      </div> {# div de la column #}

      </div> {# div de la columns #}

         <div class="columns">
      <div class="column">
      <p>Composition du ménage *</p>
      <div class="field is-horizontal">
        <div class="field-body">
          <div class="field">
            <div class="control">
            <div class="file is-large">  
            <label class="file-label">
                {{ form_widget(form.compoMenage, {
           'attr': {
           'class':  
            'file-input', 
             }
          }) 
            }}
                <span class="file-cta">
              <span class="file-icon">
               <i class="fas fa-upload"></i>
              </span>
           <span class="file-label">
        Choisissez le fichier…
      </span>
    </span>
  </label>
  </div>
            </div>
            <small>{{ form_help(form.compoMenage) }}</small>
          <div class="form-error">
            {{ form_errors(form.compoMenage) }}
          </div>
          </div>
        </div>
      </div>
      </div> {# div de la column #}

      <div class="column">
      <p>Autre document- "facultatif"</p>
      <div class="field is-horizontal">
        <div class="field-body">
          <div class="field">
            <div class="control">
            <div class="file is-large">  
            <label class="file-label">
                {{ form_widget(form.autreDoc, {
           'attr': {
           'class':  
            'file-input', 
             }
          }) 
            }}
                <span class="file-cta">
              <span class="file-icon">
               <i class="fas fa-upload"></i>
              </span>
           <span class="file-label">
        Choisissez le fichier…
      </span>
    </span>
  </label>
  </div>
            </div>
            <small>{{ form_help(form.autreDoc) }}</small>
          <div class="form-error">
            {{ form_errors(form.autreDoc) }}
          </div>
          </div>
        </div>
      </div>
      </div> {# div de la column #}

           </div> {# div de la columns #}


    </div>




    <div class="step-content has-text-centered">
      <h1 class="title is-4">Récapitulatif</h1>
      <button class="button " style="background:#5271ff;" type="submit"><span class="text">Je valide</span><span class="icon is-small"><i class="fas fa-arrow-right"></i></span>
    </div>
</div>
  <div class="steps-actions">
    <div class="steps-action">
      <a href="#" data-nav="previous" class="button is-medium is-light">Retour</a>
    </div>
    <div class="steps-action">
      <a href="#" data-nav="next" class="button is-medium is-link">Continuer</a>
    </div>
  </div>
</div>
<script src="{{ asset('https://cdn.jsdelivr.net/npm/bulma-steps@2.2.1/dist/js/bulma-steps.js') }}"></script>
<script>bulmaSteps.attach();</script>

{{ form_end(form) }}

  </div>
  </div>
  </div>
  </div>
					
{% endblock %}


